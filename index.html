<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é©¬åˆ°åŠŸæˆ 2026 - GHL Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- HTML2Canvas for Screenshots -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.FB_SDK = { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, getFirestore, collection, addDoc, serverTimestamp };
    </script>

    <style>
        /* æ ¸å¿ƒåŠ¨ç”» */
        @keyframes float-up-fast {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { opacity: 1; transform: translateY(-30px) scale(1.3); }
            100% { transform: translateY(-120px) scale(1); opacity: 0; }
        }
        .animate-float-up-fast { animation: float-up-fast 0.9s ease-out forwards; }

        @keyframes bounce-short { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .animate-bounce-short { animation: bounce-short 0.5s ease-in-out infinite; }

        @keyframes swing {
            0% { transform: rotate(-5deg); transform-origin: top center; }
            50% { transform: rotate(5deg); transform-origin: top center; }
            100% { transform: rotate(-5deg); transform-origin: top center; }
        }
        .animate-swing { animation: swing 3s ease-in-out infinite; }

        @keyframes gallop-bg {
            0% { transform: translateX(250%) scale(var(--horse-scale, 0.8)); opacity: 0; }
            10% { opacity: var(--horse-opacity, 0.15); }
            90% { opacity: var(--horse-opacity, 0.15); }
            100% { transform: translateX(-150%) scale(var(--horse-scale, 0.8)); opacity: 0; }
        }
        .animate-gallop-bg { animation: gallop-bg var(--horse-speed, 10s) linear infinite; }

        .scale-in-center { animation: scale-in-center 0.4s cubic-bezier(0.175, 0.885, 0.320, 1.275) both; }
        @keyframes scale-in-center { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            overflow: hidden; 
            background-color: #b91c1c; 
        }
        #root { height: 100vh; position: relative; z-index: 10; display: flex; align-items: center; justify-content: center; }

        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        input:focus { outline: none; border-color: #fbbf24; }

        @media (orientation: landscape) and (max-height: 500px) {
            .game-panel {
                height: 74vh !important; 
                width: auto !important;
                aspect-ratio: 16 / 9;
                border-width: 4px !important;
                border-radius: 1.5rem !important;
            }
        }
    </style>
</head>
<body>
    <canvas id="fireworksCanvas"></canvas>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const Icons = {
            Play: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            Trophy: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>,
            Timer: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Rotate: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8M3 3v5h5"></path></svg>,
            Volume2: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>,
            VolumeX: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>,
            Camera: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
        };

        const PLAYLIST = [
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d5416cfbcd78333721e04.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d54167f6dcfd23737a244.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d5416cfbcd7273c721e06.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d5416bfe00f9556f74c46.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d5416bfda3c4d513b1fa4.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d5416cfbcd70b18721e05.wav",
            "https://storage.googleapis.com/msgsndr/CRFp3DFW7bydKl8ceIKU/media/698d541652c9529751260071.wav"
        ];

        const HORSE_WISHES = [
            { zh: "é©¬ä¸Šæš´å¯Œ", en: "Instant Wealth" },
            { zh: "é©¬åˆ°å·…å³°", en: "Peak Performance" },
            { zh: "é©¬ä¸Šå¼€æŒ‚", en: "Level Up Instantly" },
            { zh: "å…¨å¹´ç‹‚é£™", en: "Unstoppable Year" },
            { zh: "èº«ä»·ç¿»å€", en: "Double Your Worth" },
            { zh: "æµé‡çˆ†æ£š", en: "Viral Success" },
            { zh: "é©¬ä¸Šå‡ºåœˆ", en: "Break the Internet" },
            { zh: "é©¬ä¸Šæˆäº¤", en: "Close Deals Swiftly" },
            { zh: "ä¸šç»©é£™å‡", en: "Performance Surge" },
            { zh: "é©¬ä¸Šå‡çº§", en: "Immediate Upgrade" },
            { zh: "è´¢æºæ»šæ»š", en: "Rolling in Riches" },
            { zh: "é©¬ä¸Šç­¾å•", en: "Instant Contracts" },
            { zh: "é©¬ä¸Šèººèµ¢", en: "Effortless Wins" },
            { zh: "ä¸€é©¬å½“å…³", en: "Leading the Charge" },
            { zh: "é©¬åˆ°åŠŸæˆ", en: "Swift Achievement" }
        ];

        const TEXTS = {
            zh: {
                title: "é©¬åˆ°åŠŸæˆ", subtitle: "Visit Malaysia 2026 Special",
                startBtn: "å¼€å§‹æ¥ç¦", musicHint: "ç‚¹å‡»æŒ‰é’®è§£é”å¤§é©¬è´ºå²é‡‘æ›² ğŸµ",
                score: "åˆ†æ•°", time: "æ—¶é—´", gameHint: "ç‚¹å‡»é©¬å„¿ï¼Œæ”¶é›†æ–°å¹´ç¥ç¦ï¼",
                resultTitle: "HENG ONG HUAT!", resultBody: "æ¥ç¦æ€»åˆ†", resultUnit: "åˆ†å¥½è¿ï¼",
                retry: "å†ç©ä¸€æ¬¡", huat: "Huat å•Š!", shareBtn: "ç”Ÿæˆæˆ˜æŠ¥å¹¶åˆ†äº«",
                nameLabel: "æ¥ç¦äººï¼š", namePlaceholder: "è¾“å…¥æ‚¨çš„åå­—",
                sharingHint: "æ­£åœ¨ç”Ÿæˆé«˜æ¸…æˆ˜æŠ¥..."
            },
            en: {
                title: "Swift Success", subtitle: "Visit Malaysia 2026 Special",
                startBtn: "Catch Blessings", musicHint: "Tap to unlock MY Festive Hits ğŸµ",
                score: "Score", time: "Time", gameHint: "Tap the horses to catch blessings!",
                resultTitle: "HENG ONG HUAT!", resultBody: "Total Blessings", resultUnit: "Points of Luck!",
                retry: "Play Again", huat: "Huat Ah!", shareBtn: "Share Screenshot",
                nameLabel: "Blessed Receiver: ", namePlaceholder: "Enter your name",
                sharingHint: "Generating Result Image..."
            }
        };

        const HorseGameApp = () => {
            const [lang, setLang] = useState('zh');
            const [gameState, setGameState] = useState('START');
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(25);
            const [activeHorses, setActiveHorses] = useState([]);
            const [currentWish, setCurrentWish] = useState('');
            const [userName, setUserName] = useState('');
            const [isMuted, setIsMuted] = useState(false);
            const [hasInteracted, setHasInteracted] = useState(false);
            const [floatingTexts, setFloatingTexts] = useState([]);
            const [currentSongUrl, setCurrentSongUrl] = useState('');
            
            // ç§˜ç±çŠ¶æ€
            const [secretClicks, setSecretClicks] = useState(0);
            const [secondarySecretClicks, setSecondarySecretClicks] = useState(0);
            
            const [isCapturing, setIsCapturing] = useState(false);

            const gameAreaRef = useRef(null);
            const resultPanelRef = useRef(null);
            const audioRef = useRef(null);
            const t = TEXTS[lang];

            const launchFireworks = () => {
                const canvas = document.getElementById('fireworksCanvas');
                const ctx = canvas.getContext('2d');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                const particles = [];
                const colors = ['#fbbf24', '#ef4444', '#ffffff', '#f59e0b', '#fde047'];
                class Particle {
                    constructor(x, y, color) {
                        this.x = x; this.y = y; this.color = color;
                        this.radius = Math.random() * 3 + 1;
                        this.velocity = { x: (Math.random() - 0.5) * 12, y: (Math.random() - 0.5) * 12 };
                        this.life = 100;
                    }
                    draw() {
                        ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                        ctx.fillStyle = this.color; ctx.globalAlpha = this.life / 100; ctx.fill();
                    }
                    update() { this.x += this.velocity.x; this.y += this.velocity.y; this.velocity.y += 0.05; this.life -= 1.5; }
                }
                const createFirework = (x, y) => {
                    for (let i = 0; i < 50; i++) particles.push(new Particle(x, y, colors[Math.floor(Math.random() * colors.length)]));
                };
                let timer = 0;
                const animate = () => {
                    if (timer < 180) {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        if (timer % 15 === 0) createFirework(Math.random() * canvas.width, Math.random() * canvas.height * 0.7);
                        particles.forEach((p, i) => { p.update(); p.draw(); if (p.life <= 0) particles.splice(i, 1); });
                        timer++; requestAnimationFrame(animate);
                    } else { ctx.clearRect(0, 0, canvas.width, canvas.height); }
                };
                animate();
            };

            const startAudio = () => {
                setHasInteracted(true);
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (ctx.state === 'suspended') ctx.resume();
                if (audioRef.current) { 
                    audioRef.current.muted = false; 
                    audioRef.current.play().catch(() => {}); 
                }
            };

            // ç§˜ç± 1: 88,888,888 åˆ† (å·¦ä¸Šè§’)
            const triggerSecret = (e) => {
                if(e) e.stopPropagation();
                startAudio();
                const nextCount = secretClicks + 1;
                if (nextCount === 8) {
                    setScore(88888888);
                    setSecretClicks(0);
                    setCurrentWish("æ­å–œå‘è´¢! 88888888 UNLOCKED!");
                    launchFireworks();
                } else {
                    setSecretClicks(nextCount);
                }
                clearTimeout(window.secretTimer);
                window.secretTimer = setTimeout(() => setSecretClicks(0), 3000);
            };

            // ç§˜ç± 2: 8888 åˆ† (å³ä¸‹è§’)
            const triggerSecondarySecret = (e) => {
                if(e) e.stopPropagation();
                startAudio();
                const nextCount = secondarySecretClicks + 1;
                if (nextCount === 8) {
                    setScore(8888);
                    setSecondarySecretClicks(0);
                    setCurrentWish("å‘è´¢é¡ºé¡ºåˆ©åˆ©! 8888 UNLOCKED!");
                } else {
                    setSecondarySecretClicks(nextCount);
                }
                clearTimeout(window.secondarySecretTimer);
                window.secondarySecretTimer = setTimeout(() => setSecondarySecretClicks(0), 3000);
            };

            const handleCatch = (id, wish, e) => {
                if (e) e.stopPropagation();
                setScore(prev => prev + 18);
                setCurrentWish(wish);
                setActiveHorses(prev => prev.filter(h => h.id !== id));
                if (!gameAreaRef.current) return;
                const rect = gameAreaRef.current.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                const newFloat = { id: Date.now(), x: clientX - rect.left, y: clientY - rect.top, text: `${t.huat} ${wish}` };
                setFloatingTexts(prev => [...prev, newFloat]);
                setTimeout(() => setFloatingTexts(prev => prev.filter(f => f.id !== newFloat.id)), 800);
            };

            const captureAndShare = async () => {
                if (!resultPanelRef.current) return;
                setIsCapturing(true);
                try {
                    document.activeElement?.blur();
                    const canvas = await html2canvas(resultPanelRef.current, {
                        backgroundColor: '#fffcf5', scale: 2, logging: false, useCORS: true,
                        ignoreElements: (el) => el.classList.contains('no-capture')
                    });
                    const imgData = canvas.toDataURL('image/png');
                    const message = lang === 'zh' ? `${userName || 'æˆ‘'}åœ¨ã€Šé©¬åˆ°åŠŸæˆã€‹æ¥åˆ°äº† ${score.toLocaleString()} åˆ†å¥½è¿ï¼` : `${userName || 'I'} captured ${score.toLocaleString()} points of Luck!`;

                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([], "a.png")] })) {
                        const res = await fetch(imgData);
                        const blob = await res.blob();
                        const file = new File([blob], "result.png", { type: "image/png" });
                        await navigator.share({ files: [file], title: t.title, text: message });
                    } else {
                        const link = document.createElement('a');
                        link.download = `Result-${score}.png`;
                        link.href = imgData;
                        link.click();
                        setCurrentWish(lang === 'zh' ? "æˆ˜æŠ¥å·²ä¿å­˜ï¼" : "Saved to gallery!");
                    }
                } catch (err) { console.error(err); }
                setIsCapturing(false);
            };

            useEffect(() => {
                setCurrentSongUrl(PLAYLIST[Math.floor(Math.random() * PLAYLIST.length)]);
            }, []);

            const spawnHorse = useCallback(() => {
                if (gameState !== 'PLAYING') return;
                const id = Date.now() + Math.random();
                const x = Math.random() * 75 + 12; 
                const y = Math.random() * 60 + 15;
                const size = Math.random() * 40 + 120;
                const wishPair = HORSE_WISHES[Math.floor(Math.random() * HORSE_WISHES.length)];
                setActiveHorses(prev => [...prev, { id, x, y, size, wish: wishPair[lang] }]);
                setTimeout(() => setActiveHorses(prev => prev.filter(h => h.id !== id)), 1300);
            }, [gameState, lang]);

            useEffect(() => {
                let si, ti;
                if (gameState === 'PLAYING') {
                    si = setInterval(spawnHorse, 650);
                    ti = setInterval(() => {
                        setTimeLeft(prev => {
                            if (prev <= 1) { setGameState('END'); return 0; }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => { clearInterval(si); clearInterval(ti); };
            }, [gameState, spawnHorse]);

            const startGame = (e) => {
                if (e) e.stopPropagation();
                startAudio(); setScore(0); setTimeLeft(25); setActiveHorses([]);
                setGameState('PLAYING'); setCurrentWish(t.gameHint);
            };

            return (
                <div className="h-full w-full bg-[#b91c1c] font-sans text-white overflow-hidden flex flex-col items-center justify-center p-1 sm:p-2 relative" onClick={startAudio}>
                    
                    {/* ç§˜ç± 1 åŒºåŸŸ (å·¦ä¸Šè§’ 88M) - ä½¿ç”¨ fixed å®šä½ç»•è¿‡å®¹å™¨é™åˆ¶ */}
                    <div 
                        className="fixed top-0 left-0 w-32 h-32 z-[99999] cursor-default bg-transparent" 
                        onClick={triggerSecret}
                        style={{ WebkitTapHighlightColor: 'transparent' }}
                    />
                    
                    {/* ç§˜ç± 2 åŒºåŸŸ (å³ä¸‹è§’ 8888) - ä½¿ç”¨ fixed å®šä½ç»•è¿‡å®¹å™¨é™åˆ¶ */}
                    <div 
                        className="fixed bottom-0 right-0 w-32 h-32 z-[99999] cursor-default bg-transparent" 
                        onClick={triggerSecondarySecret}
                        style={{ WebkitTapHighlightColor: 'transparent' }}
                    />

                    {hasInteracted && currentSongUrl && <audio ref={audioRef} src={currentSongUrl} autoPlay loop muted={isMuted} />}

                    <div className="absolute bottom-0 left-0 w-full h-32 pointer-events-none overflow-hidden z-0">
                        <div className="animate-gallop-bg text-2xl" style={{ animationDelay: '2s', animationDuration: '13s', bottom: '80px', '--horse-opacity': '0.15', '--horse-scale': '0.5', filter: 'sepia(1) saturate(5) hue-rotate(15deg) brightness(1.3) blur(1px)', position: 'absolute' }}>ğŸ</div>
                        <div className="animate-gallop-bg text-7xl" style={{ animationDelay: '0s', animationDuration: '6s', bottom: '-10px', '--horse-opacity': '0.5', '--horse-scale': '1.2', filter: 'sepia(1) saturate(20) hue-rotate(20deg) brightness(1.6) drop-shadow(0 0 20px #fbbf24)', position: 'absolute' }}>ğŸ</div>
                    </div>

                    <div className="fixed top-4 right-4 z-50 flex items-center gap-2">
                        <div className="bg-black/40 p-1.5 rounded-full backdrop-blur-md border border-white/20 flex items-center gap-3">
                            <button onClick={(e) => { e.stopPropagation(); setLang(lang === 'zh' ? 'en' : 'zh'); }} className="bg-white/10 text-[9px] font-black w-8 h-8 rounded-full uppercase flex items-center justify-center border border-white/10">{lang === 'zh' ? 'EN' : 'ä¸­'}</button>
                            <button onClick={(e) => { e.stopPropagation(); setIsMuted(!isMuted); if(audioRef.current) audioRef.current.muted = !isMuted; }} className="bg-yellow-500 w-8 h-8 rounded-full text-red-800 flex items-center justify-center">{isMuted ? <Icons.VolumeX /> : <Icons.Volume2 />}</button>
                        </div>
                    </div>

                    <div className="game-panel w-full h-full max-w-[72vw] max-h-[72vh] bg-[#fffcf5] rounded-[1.5rem] sm:rounded-[2.5rem] shadow-2xl border-[4px] sm:border-[8px] border-yellow-500 relative overflow-hidden flex flex-col z-10">
                        <div className="game-header bg-gradient-to-r from-red-800 via-red-600 to-red-800 p-2 sm:p-3 flex justify-between items-center text-yellow-400 font-black z-10 shadow-md text-[10px] sm:text-xs">
                            <div className="bg-yellow-500/20 px-3 py-1 rounded-full border border-yellow-500/30 flex items-center gap-1.5"><Icons.Trophy /> <span>{t.score} {score.toLocaleString()}</span></div>
                            <div className="text-sm sm:text-2xl tracking-widest uppercase font-serif flex-grow text-center">{t.title}</div>
                            <div className="bg-black/20 px-3 py-1 rounded-full border border-white/20 flex items-center gap-1.5"><Icons.Timer /> <span>{t.time} {timeLeft}s</span></div>
                        </div>

                        <div ref={gameAreaRef} className="flex-grow relative bg-[url('https://www.transparenttextures.com/patterns/oriental-tiles.png')] bg-repeat overflow-hidden flex flex-col">
                            {gameState === 'START' && (
                                <div className="absolute inset-0 z-20 flex flex-col items-center justify-center bg-red-950/40 backdrop-blur-[2px] p-2 text-center">
                                    <div className="bg-white/95 p-6 sm:p-10 rounded-[2rem] border-2 border-yellow-500 shadow-2xl scale-in-center flex flex-col items-center max-w-[90%] sm:max-w-md">
                                        <div className="text-5xl mb-4 animate-bounce">ğŸ</div>
                                        <h1 className="text-3xl sm:text-5xl font-black text-red-600 mb-1 tracking-tighter uppercase">{t.title}</h1>
                                        <p className="text-red-800 font-bold mb-8 opacity-70 text-[10px]">{t.subtitle}</p>
                                        <button onClick={startGame} className="bg-red-600 text-yellow-300 px-8 py-4 rounded-full text-xl sm:text-4xl font-black shadow-[0_6px_0_#7f1d1d] active:translate-y-1 active:shadow-none uppercase flex items-center gap-3"><Icons.Play /> {t.startBtn}</button>
                                        
                                        <div className="mt-8 pt-4 border-t border-red-900/10 w-full text-[8.5px] sm:text-[10px] text-red-900/50 font-medium leading-tight select-none">
                                            <p className="mb-1">This game is for 2026 CNY celebration only. Non-commercial use. Developer not liable for any misuse.</p>
                                            <p className="mb-2">æœ¬æ¸¸æˆä»…ä¾›2026é©¬å¹´æ–°æ˜¥åº†ç¥ä½¿ç”¨ï¼Œç¦æ­¢å•†ç”¨ã€‚å¼€å‘è€…ä¸æ‰¿æ‹…è¯¯ç”¨è´£ä»»ã€‚</p>
                                            <p className="font-bold border-t border-red-900/5 pt-1 uppercase">éŸ³ä¹ç‰ˆæƒå½’éƒ‘æ–Œå½¦ï¼ˆBingyenï¼‰2026è´ºå²ç³»åˆ—æ‰€æœ‰ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {gameState === 'PLAYING' && (
                                <div className="relative h-full w-full">
                                    {activeHorses.map(horse => (
                                        <button key={horse.id} onClick={(e) => handleCatch(horse.id, horse.wish, e)} style={{ left: `${horse.x}%`, top: `${horse.y}%`, width: `clamp(90px, ${horse.size}px, 160px)`, height: `clamp(90px, ${horse.size}px, 160px)` }} className="absolute animate-bounce-short transform -translate-x-1/2 -translate-y-1/2 transition-transform active:scale-125">
                                            <span className="text-6xl sm:text-9xl select-none block drop-shadow-lg">ğŸ</span>
                                        </button>
                                    ))}
                                    <div className="absolute bottom-4 sm:bottom-8 left-0 w-full flex justify-center px-4">
                                        <div className="bg-red-600 text-yellow-300 px-6 py-3 rounded-2xl font-black text-lg sm:text-4xl shadow-2xl border-2 border-yellow-400 text-center uppercase tracking-tighter">
                                            {currentWish || t.gameHint}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {gameState === 'END' && (
                                <div className="absolute inset-0 z-30 flex flex-col items-center justify-center bg-red-900/95 backdrop-blur-lg p-4 text-center">
                                    <div ref={resultPanelRef} className="bg-[#fffcf5] p-6 sm:p-8 rounded-[2rem] border-4 border-yellow-500 shadow-2xl scale-in-center flex flex-col items-center text-red-900 w-full max-w-sm">
                                        <div className="text-4xl mb-2">ğŸ§§</div>
                                        <h2 className="text-2xl sm:text-4xl font-black text-red-600 mb-1 italic uppercase tracking-tighter">{t.resultTitle}</h2>
                                        <div className="w-full mt-4 flex flex-col items-center">
                                            <div className="text-red-800/60 text-[10px] font-bold uppercase tracking-widest mb-1">{t.nameLabel}</div>
                                            <input type="text" value={userName} onChange={(e) => setUserName(e.target.value)} placeholder={t.namePlaceholder} className="w-4/5 bg-red-100/50 border-b-2 border-red-200 text-center text-xl font-black text-red-700 py-1 no-capture" />
                                            <div className="hidden block-in-capture text-2xl font-black text-red-700 mb-2">{userName || 'GUEST'}</div>
                                        </div>
                                        <p className="text-sm mt-6 mb-2 uppercase font-bold opacity-70">{t.resultBody}</p>
                                        <span className="text-4xl sm:text-6xl font-black text-red-600 mb-4 block">{score.toLocaleString()}</span> 
                                        <div className="flex flex-col gap-3 w-full no-capture">
                                            <button onClick={startGame} className="bg-red-600 text-yellow-300 w-full py-3 rounded-full text-lg font-black shadow-lg flex items-center justify-center gap-2 uppercase tracking-tighter transition-all active:scale-95"><Icons.Rotate /> {t.retry}</button>
                                            <button onClick={captureAndShare} disabled={isCapturing} className={`bg-yellow-500 text-red-900 w-full py-3 rounded-full text-lg font-black shadow-md flex items-center justify-center gap-2 uppercase tracking-tighter transition-all active:scale-95 ${isCapturing ? 'opacity-50' : ''}`}>
                                                {isCapturing ? t.sharingHint : <><Icons.Camera /> {t.shareBtn}</>}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {floatingTexts.map(f => <div key={f.id} className="absolute pointer-events-none text-xl sm:text-3xl font-black text-red-600 animate-float-up-fast z-40 uppercase tracking-tighter" style={{ left: f.x, top: f.y }}>{f.text}</div>)}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HorseGameApp />);
    </script>
</body>
</html>
